{% extends "profiles/global-base-ui/sidebar_menu.html" %} 

{% load um_tags %}
{% load widget_tweaks %}

{% block dashboard %}

  <div class="container fluid">
      {{geoform.media}}
      <div class="ui grid" style="margin: 0%; padding: 0%;">
        <div class="two column row">
            <div class="nine wide column"  style="margin-right:0%;">
                {%if cb %}
                {%if cb.status == 'Pending' %}
                <div class="ui info message">
                   
                    <div class="header">
                      <i></i>
                        YOU HAVE BEEN CALLED BACK TO BASE! 
                        <a href="{% url 'unitmanagement:confirm_going_back' cb.id %}" class="ui orange small button">Confirm</a>
                    </div>
                    <ul class="list">
                      <li>Please confirm that
                          you have received the message and will return at your most earliest
                          convenient time. </li>
                    </ul>
                  </div>
                  {% else %}
                  <div class="ui info icon message">
                      <i class="exclamation icon"></i>
                      <div class="content">
                        <div class="header">
                            Admin is awaiting your arrival back to base.
                        </div>
                      </div> 
                  </div>
                  {% endif %}
                  {% endif %}

            
                  <div class="ui three column grid">
                    <div class="column">
                        <div class="ui raised segment">
                            <div class="card">
                                <div class="content">
                                    <i class="huge green check icon"></i>
                                </div>
                                <div class="extra content">
                                    <strong>
                                        <a href="">DAILY REFRESHER</a>
                                    </strong>
                                </div>
                            </div>
                          
                        </div>
                    </div>
                    <div class="column">
                        <div class="ui raised segment">
                            <div class="ui statistic">
                              <div class="value">
                                07/30/18
                              </div>
                              <div class="label">
                                Upcoming Deployment
                              </div>
                            </div>
                          </div>
                    </div>
                    <div class="column">
                        <div class="ui raised segment">
                            <div class="ui statistic">
                              <div class="value">
                                <i class="ship icon"></i> 5
                              </div>
                              <div class="label" style="font-size: 11px;">
                                (Add info on port/request details)
                              </div>
                            </div>
                          </div>
                    </div>
                  </div>

                    {% if k9 %}
                    <div class = "ui segment" id = "start_end_training">
                    <table class="ui very basic four column table">
                    <thead>
                    <tr>
                    <th>Status: {{k9.training_status}}</th>
                    <th>Type: {{k9.status}}</th>
                    <th>Capability: {{k9.capability}}</th>

                        {% if k9.training_status == "On-Training" %}
                    <th>Training Stage: {{k9.training_level}} </th>

                        <th><h3>Training</h3><div><strong>Date Start :</strong> {{training_sched.date_start}}</div>
                            <div><strong>Date End :</strong> {{training_sched.date_end}}</div></th>

                        {% else %}


                        {% endif %}
                    </tr>
                    </thead>
                    </table>

                        {% if k9.training_level %}
                        <form class="ui form" method="POST">
                            {% csrf_token %}

                            {% if show_start == True and show_end == False %}
                            <input class = "ui green button" type="submit" name = "start_training" value="Start Training">

                            {% elif show_start == False and show_end == True %}
                            <input class = "ui green button" type="submit" name = "end_training" value="End Training">

                            {% elif show_start == True and show_end == True%}
                            <h3 class = "ui blue header">Pending grade for current training stage.</h3>
                            {% else %}
                            {% endif %}

                        </form>
                        {% endif %}

                        {% if reveal_items == True %}
                            <div class="ui two column grid">
                                <div class="six wide column">
                                    <input class = "ui green button" type="submit"  value="Confirm Initial Deployment" id = "reveal_predep_checklist">
                                </div>
                                 <div class="ten wide column">
                                     <strong>Deployment Date : </strong> <span>{{pre_deployment_item.initial_sched.date_start}} </span> <br>
                                      <strong>Port: </strong> <span>{{pre_deployment_item.initial_sched.team.team}}</span>
                                </div>
                            </div>
                        {% elif all_clear == True and reveal_items == True %}
                         <strong>Deployment Date : </strong> <span>{{pre_deployment_item.initial_sched.date_start}} </span> <br>
                        <strong>Port: </strong> <span>{{pre_deployment_item.initial_sched.team.team}}</span>
                        {% else %}
                        {% endif %}

                        </div>
                        {% else %}
                        <div class = "ui segment">
                            You don't have a K9 yet.
                        </div>
                        {% endif %}


                      
                  <div class="ui raised segment" >
                      <canvas id="myChart" height="355" ></canvas>
                  </div>
              </div>

              <div class="seven wide column" style="padding: 0%;margin:0%;">
                <div class="ui right aligned basic segment" style="padding: 0%;margin:0%;">

                    <div class="ui buttons">
                      <button class="ui button"  id = "prev" >Previous Year</button>
                      <div class="or"></div>
                      <button class="ui button"  id = "next" >Next Year</button>
                    </div>

                    <div id = "calendar" style="margin-top:0%;"></div>
                </div>
              </div>
        </div>
      </div>


        {% if messages %}
        {% for message in messages %}
            <input class="msg" type='hidden' value="{{message}}">
        {% endfor %}
        {% endif %}
    </div>


   <!--Pre Deployment Items Modal-->

<div class="ui mini modal" id = 'modal3'>
      <i class="close icon"></i>
    <div class="header"><h2>Pre Deployment Requirements</h2></div>
    <div class="scrolling content">
             {% for item in items_list %}
                    {% if item.0 == True %}
                    <h4><i class="green check icon"></i>{{item.1}}</h4>
                    {%else%}
                    <h4><i class="red close icon"></i>{{item.1}}</h4>
                    {%endif%}
                {% endfor %}


        <form  class="ui form" method="POST">
             {% csrf_token %}
            {% if all_clear == True %}
            <button class="ui green button" type="submit" name = "confirm_deployment" value="Confirm Deployment"><i class="ship icon"></i>Confirm Deployment</button>

            {% else %}
            <button class="ui disabled green button"><i class="ship icon"></i>Confirm Deployment</button>

            {% endif %}
        </form>

    </div>
</div>
 <!--End Pre Deployment Items Modal-->


<style>

#prev, #next{
  background-color:orangered;
  color: white;
  }

/* 
  #calendar {
      max-width: 900px;
      margin: 40px auto;
  } */
</style>
    
<script>
$(document).ready(function() {
      // alert($('.msg').val());

      
      if($('.msg').val() == 'event'){
        $('#modal2').modal('show');
      }

      var endpoint = '../../unitmanagement/handler/api'
      var performance = []
      var sched = []
      $.ajax({
          method: "GET",
          url: endpoint,
          success: function(data){
            performance = data.performance
            sched = data.sched
            setChart()         
          },
          error: function(error_data){
            console.log("error")
            console.log(error_data)
          }
      })

    function setChart(){
        var ctx = document.getElementById('myChart');
        //Chart1
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
              datasets: [{
                    label: "{{k9}}",
                    data: performance,
                    backgroundColor: ['rgba(75, 192, 192, 0.5)'],
                    borderColor: ['rgba(75, 192, 192, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                animateScale: true,
            },
            title: {
                display: true,
                text: "K9 Performance"
            },
            scales: {
                xAxes: [{
                ticks: {
                    beginAtZero: true,
                }
                }],
                yAxes: [{
                ticks: {
                    beginAtZero: true,
                    step:1,
                    suggestedMax:100,
                }
                }]
            },
          }
        });
      }

      //Calendar
      
      $('#calendar').fullCalendar({
          header: {
              left: 'prev,next today',
              center: 'title',
              right: 'month,agendaWeek,agendaDay'
          },

          defaultView: 'month',
          weekNumbers: 'true',
          editable: false,
          selectable: true,
          eventLimit: 3,
          showNonCurrentDates: true,


          eventTextColor: "white",
          nowIndicator: true,

          events: [
                <!--{% for i in events %}-->
                <!--{-->
                    <!--id: '{{ i.id }}',-->
                    <!--title: '{{i.event_name}}',-->
                    <!--start: '{{ i.start_date|date:"Y-m-d" }}',-->
                    <!--end: '{{ i.end_date|date:"Y-m-d" }}',-->
                    <!--allDay: 'true',-->
                <!--},-->
                <!--{% endfor %}-->

                    {% for i in k9_schedules %}
                    {
                    id: '{{ i.id }}',

                    {% if i.status == 'Request' %}
                    title: 'Request : {{i.dog_request}}',
                    {% else %}
                    title: 'Port : {{i.dog_request}}',
                    {% endif %}

                    start: '{{ i.date_start|date:"Y-m-d" }}',
                    end: '{{ i.date_end|date:"Y-m-d" }}',
                    allDay: 'true',
                    },
                    {% endfor %}
            ],

          eventClick : function(event, element){
            $('.content').text(event.title);
            $('.event_modal').modal('show');
            
          },

          }); // end #calendar
          
          

        $('#prev').click(function() {
        $('#calendar').fullCalendar('prevYear');
        });

        $('#next').click(function() {
        $('#calendar').fullCalendar('nextYear');
        });


     
});
</script>


<script>

    $( "#reveal_predep_checklist" ).click(function() {
  $('#modal3').modal('setting', 'closable', false).modal('show');
});
</script>


{% endblock %}