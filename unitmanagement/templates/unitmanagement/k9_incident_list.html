{% extends "profiles/sidebar_um.html" %}
{% load static %}
{% block content %}
<div class="ui inverted segment" style="padding:20px;">
    <h3 class="ui header">{{ title }}</h3>
    {% if messages %}
    {% for message in messages %}
        <div class="{{style}}" > {{ message }}</div>
    {% endfor %}
    {% endif %}
</div>
{% if user.position == 'Team Leader' %}
<div class="ui segment" data-tab="first">
    <table id="tabledata1" class="ui five column celled table">
        <thead>
            <tr>
                <th>Date Reported</th>
                <th>Incident</th>
                <th>K9</th>
                <th>Reported By:</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for data in data %}
            <tr data-variation="wide" data-content="{{data.description}}" class="pop">
                <td>{{data.date}}</td>
                <td>{{data.incident}}</td>
                <td>{{data.k9}}</td>
                <td>{{data.reported_by}}</td>
                <td class="center aligned three wide">
                    <a href="{% url 'unitmanagement:k9_retreived' data.id %}" class="ui blue button">Retrieved</a>
                </td>
            </tr>
            
            {% endfor %}
        </tbody>
    </table>
</div>
{% elif user.position == 'Administrator' %}
<div class="ui segment" data-tab="first">
        <table id="tabledata1" class="ui five column celled table">
            <thead>
                <tr>
                    <th>Date Reported</th>
                    <th>Incident</th>
                    <th>K9</th>
                    <th>Reported By</th>
                    <th>Port/Area</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for data in data %}
                <tr data-variation="wide" data-content="{{data.description}}" class="pop">
                    <td>{{data.date}}</td>
                    <td>{{data.incident}}</td>
                    <td>{{data.k9}}</td>
                    <td>{{data.reported_by}}</td>
                    {% if data.k9.assignment == 'None' %}
                        <td>PCGK9 Taguig</td>
                    {%else%}
                        <td>{{data.k9.assignment}}</td>
                    {%endif%}
                    <td class="center aligned three wide">
                        <a href="{% url 'unitmanagement:k9_retreived' data.id %}" class="ui blue button">Retrieved</a>
                    </td>
                </tr>
                
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
<div class="ui segment" data-tab="first">
        <table id="tabledata1" class="ui column celled table">
            <thead>
                <tr>
                    <th>Date Reported</th>
                    <th>K9</th>
                    <th>Reported By</th>
                    <th>Port/Area</th>
                    <th>Clinic</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for data in data %}
                <tr>
                    <td>{{data.date}}</td>
                    <td>{{data.k9}}</td>
                    <td>{{data.reported_by}}</td>
                    {% if data.k9.assignment == 'None' %}
                        <td>PCGK9 Taguig</td>
                    {%else%}
                        <td>{{data.k9.assignment}}</td>
                    {%endif%}
                    <td>{{data.clinic}}</td>
                    <td class="center aligned three wide">
                        <a href="{% url 'unitmanagement:k9_accident' data.id%}?accident=recovered" class="ui tiny blue button">Recovered</a>
                        <button class="ui tiny red button died" id ='{{data.id}}' data-var='{{data.k9}}'>Died</button>
                    </td>
                </tr>
                
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="ui modal" id = 'id_data'></div>

    <div class="ui mini modal" id = 'accident_modal'>
        <div class="header" id = 'header'></div>
        <div class="content">
        
            <form class="ui form" method="POST">
                {% csrf_token %}
                <input type="hidden" value="" id='input_id' name='input_id'>
                <div class="field">
                    <label>Date Died</label>
                    <input type="date" name = 'date_died'>
                </div>
                <div class="field">
                    <label>Death Certificate</label>
                    <input type="file" name = 'death_cert'>
                </div>
               
                <div class="ui center aligned basic segment" style="padding: 0px;">
                    <button type="submit" class="ui tiny blue button">Submit</button>
                </div>
            </form>

        </div>
    </div>
{% endif %}

<script type="text/javascript">

    $(document).ready(function() {
        $('#tabledata1').DataTable({
            "order": [[ 0, "desc" ]]
        });
        $('.menu .item').tab();
        
        $( ".flip" ).bind('click', function() {
            var url = 'k9-incident-list/ajax_load_incident';  
            var id = $(this).attr('id')
            $('#id_data').modal('show');
            $.ajax({                         
                url: url,                  
                data: {
                'id': id       
                },
                success: function (data) {  
                    $("#id_data").html(data);
                }
            });
         
        });

        $( ".died" ).bind('click', function() {
            var k9 = $(this).attr('data-var')
            var id = parseInt($(this).attr('id'))
            $('#input_id').val(id);
            $('#header').text(k9);
            $('#accident_modal').modal('show');
           
        });
    });

</script>
 {% endblock %}
